getwd()
psNCbyBlock = psNCbyBlock
stringent = FALSE
x <- psNCbyBlock[[1]]
x
ps.to.dq <- phyloseq_to_deseq2(x, design = ~1)
geo.mean <- function(y) {
if(all(y == 0)){
val <- 0
}else{
val <- exp(sum(log(y[y > 0]))/length(y))
}
return(val)
}
geom.mean.row <- apply(counts(ps.to.dq), 1, FUN = geo.mean)
geom.mean.row
ps.to.dq <- estimateSizeFactors(ps.to.dq, geoMeans = geom.mean.row)
dq <- DESeq(ps.to.dq, fitType = "local", minReplicatesForReplace= Inf)
library.size.norm <- sizeFactors(dq)
library.size.norm
ot.tab <- t(t(otu_table(x))/library.size.norm)
S_j0 <- round(median(colSums(ot.tab)), digits = 0)
colSums(ot.tab)
mu_ij_0_all <- assays(dq)[["mu"]]
dim9mu_ij_0_all
dim(mu_ij_0_all)
ps
x
colSums(mu_ij_0_all)
colSums(mu_ij_0_all, na.rm = TRUE)
View(data.frame(colSums(ot.tab), colSums(mu_ij_0_all, na.rm = TRUE)))
assays(dq)["mu"]
assays(dq)[["mu"]]
assays(dq)[["mu"]][1,]
colSums(ot.tab)
summary(colSums(ot.tab))
summary(colSums(otu_table(x)))
install.packages(c("HDInterval", "R.utils"))
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
pkgs = c("DESeq2",
"phyloseq",
"dplyr",
"tidyr",
"R.utils",
"BiocParallel",
"doParallel",
"parallel",
"HDInterval",
"grid",
"xtable",
"gtable",
"gridExtra",
"BiocStyle",
"magrittr")
if (!requireNamespace("BiocManager")){
install.packages("BiocManager")
}
BiocManager::install(setdiff(pkgs, installed.packages()), update = TRUE)
setdiff(pkgs, installed.packages())
pkgs = c("DESeq2",
"phyloseq",
"dplyr",
"tidyr",
"R.utils",
"BiocParallel",
"doParallel",
"parallel",
"HDInterval",
"grid",
"xtable",
"gtable",
"gridExtra",
"BiocStyle",
"magrittr")
setdiff(pkgs, installed.packages())
pkgs = c("DESeq2",
"phyloseq",
"dplyr",
"tidyr",
"R.utils",
"BiocParallel",
"doParallel",
"parallel",
"HDInterval",
"grid",
"xtable",
"gtable",
"gridExtra",
"BiocStyle",
"magrittr")
if (!requireNamespace("BiocManager")){
install.packages("BiocManager")
}
BiocManager::install(setdiff(pkgs, installed.packages()), update = TRUE)
devtools::install_github("PratheepaJ/BARBI")
library(BARBI)
library(devtools)
library(phyloseq)
library(DESeq2)
library(dplyr)
library(tidyr)
library(R.utils)
library(BiocParallel)
library(doParallel)
library(parallel)
library(HDInterval)
library(grid)
library(xtable)
library(gtable)
library(gridExtra)
library(BiocStyle)
library(magrittr)
ncores = as.integer(Sys.getenv("SLURM_NTASKS"))
if(is.na(ncores)) ncores = parallel::detectCores()
ps = ps
View(sample_data(ps) %>% data.frame())
ps
install.packages("ggrepel")
Subset samples such that only patient plasma, healthy subject control, and negative controls are included in the final phyloseq object.
ps
View(sample_data(ps) %>% data.frame())
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, Sample_Type%in%c("Standard"))
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, SampleType %in% c("Standard"))
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
Contaminants1 = names(prevTaxaP)[prevTaxaP==0]
ps = prune_taxa(prevTaxaP>0, ps)
Contaminants1
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
pkgs = c("DESeq2",
"phyloseq",
"dplyr",
"tidyr",
"R.utils",
"BiocParallel",
"doParallel",
"parallel",
"HDInterval",
"grid",
"xtable",
"gtable",
"gridExtra",
"BiocStyle",
"magrittr")
if (!requireNamespace("BiocManager")){
install.packages("BiocManager")
}
BiocManager::install(setdiff(pkgs, installed.packages()))
devtools::install_github("PratheepaJ/BARBI")
library(BARBI)
library(devtools)
library(phyloseq)
library(DESeq2)
library(dplyr)
library(tidyr)
library(R.utils)
library(BiocParallel)
library(doParallel)
library(parallel)
library(HDInterval)
library(grid)
library(xtable)
library(gtable)
library(gridExtra)
library(BiocStyle)
library(magrittr)
ncores = as.integer(Sys.getenv("SLURM_NTASKS"))
if(is.na(ncores)) ncores = parallel::detectCores()
ps = ps
blocks = rep("Set1", nsamples(ps))
sample_data(ps)$block = blocks
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, SampleType %in% c("Standard"))
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
Contaminants1 = names(prevTaxaP)[prevTaxaP==0]
ps = prune_taxa(prevTaxaP > 0, ps)
ps
ps_specimen
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
table(prevTaxaP)
ps
prune_taxa(taxa_sums(ps)>0, ps)
dim(otu_table(ps_specimen))
ps = ps
if(dim(otu_table(ps))[1]!=ntaxa(ps)){otu_table(ps) <- t(otu_table(ps))}
blocks = rep("Set1", nsamples(ps))
sample_data(ps)$block = blocks
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, SampleType %in% c("Standard"))
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
Contaminants1 = names(prevTaxaP)[prevTaxaP == 0]
ps = prune_taxa(prevTaxaP > 0, ps)
ps
totalReads = colSums(otu_table(ps))
hist(log(totalReads), yaxs="i", xaxs="i", main="Distribution of total reads per sample", breaks=50)
table(sample_data(ps)$SampleType,sample_data(ps)$block)
View(sample_data(ps) %>% data.frame())
View(sample_data(ps) %>% data.frame())
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 12)
psBlockResult = psBlockResults(ps,
sampleTypeVar = "SampleType",
caselevels = c("Standard"),
controllevel = c("Negative"),
sampleName = "Name",
blockVar = "block")
dim(otu_table(ps))
rm(list = ls)
rm(list = ls())
devtools::load_all(".")
ps = ps
if(dim(otu_table(ps))[1]!=ntaxa(ps)){otu_table(ps) = t(otu_table(ps))}
blocks = rep("Set1", nsamples(ps))
sample_data(ps)$block = blocks
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, SampleType %in% c("Standard"))
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
Contaminants1 = names(prevTaxaP)[prevTaxaP == 0]
ps = prune_taxa(prevTaxaP > 0, ps)
ps
totalReads = colSums(otu_table(ps))
hist(log(totalReads), yaxs="i", xaxs="i", main="Distribution of total reads per sample", breaks=50)
table(sample_data(ps)$SampleType,sample_data(ps)$block)
psBlockResult = psBlockResults(ps,
sampleTypeVar = "SampleType",
caselevels = c("Standard"),
controllevel = c("Negative"),
sampleName = "Name",
blockVar = "block")
levels(sample_data(ps)$SampleType)
class(sample_data(ps)$SampleType)
dim(otu_table(ps))[1] != ntaxa(ps)
sampleTypeVar = "SampleType"
caselevels = c("Standard"
90+450+200+600+300+200
90+450+200+600+300+200
450+400+200+150
200+1500+450+300+300
1840+1200+2750
8000-5790
100+500+300+750+300+200
100+500+500+200+150
300+1500+500+300+300
2150+1450+2900
150+500+750+300+200
1900-100
1800-250
100+500+750+200
2150+1500+1450+2900
14*15
15*12
3000+1200+100+180
7000-4480
sampleTypeVar
sampleTypeVar = "SampleType"
caselevels = c("Standard")
controllevel = c("Negative")
sampleName = "Name"
blockVar = "block"
if (dim(otu_table(ps))[1] != ntaxa(ps)) {
otu_table(ps) = t(otu_table(ps))
}
Sample_Type = NULL
names(sample_data(ps))[names(sample_data(ps)) == sampleTypeVar] = "Sample_Type"
names(sample_data(ps))[names(sample_data(ps)) == blockVar] = "block"
names(sample_data(ps))[names(sample_data(ps)) == sampleName] = "SampleCode"
samdf = sample_data(ps) %>% data.frame()
gr = samdf$block
samdfL = split(samdf, gr)
blockSamples = lapply(samdfL, function(x) {
as.character(x$SampleCode)
})
psByBlock = list()
psByBlock[[i]] = prune_samples(blockSamples[[i]], ps)
for (i in 1:length(blockSamples)) {
psByBlock[[i]] = prune_samples(blockSamples[[i]], ps)
}
blockSamples
prune_samples(blockSamples[[1]], ps)
prune_samples(blockSamples[[2]], ps)
psBlockResult = psBlockResults(ps,
sampleTypeVar = "SampleType",
caselevels = c("Standard"),
controllevel = c("Negative"),
sampleName = "sampleID",
blockVar = "block")
#' @return A list of estimated distribution parameters for the intensity of contamination in negative control samples.
#' @examples
#' \dontrun{
#' alphaBetaNegControl(psNCByBlock)
#' }
#' @import DESeq2
#' @importFrom SummarizedExperiment assays
#' @importFrom Biobase rowMedians
#' @importFrom stats median var runif dgamma rgamma
#' @export
alphaBetaNegControl = function(psNCbyBlock, stringent = FALSE) {
compAlphaBeta = lapply(psNCbyBlock, function(x) {
ps.to.dq <- phyloseq_to_deseq2(x, design = ~1)
geo.mean = function(y) {
if(all(y == 0)){
val = 0
}else{
val = exp(sum(log(y[y > 0]))/length(y))
}
return(val)
}
geom.mean.row = apply(counts(ps.to.dq), 1, FUN = geo.mean)
ps.to.dq = estimateSizeFactors(ps.to.dq, geoMeans = geom.mean.row)
dq = DESeq(ps.to.dq, fitType = "local", minReplicatesForReplace= Inf)
library.size.norm = sizeFactors(dq)
ot.tab = t(t(otu_table(x))/library.size.norm)
S_j0 = round(median(colSums(ot.tab)), digits = 0)
mu_ij_0_all = assays(dq)[["mu"]]
mu_ij_0 = apply(mu_ij_0_all, 1, function(x){
if(all(is.na(x))){
NA
}else{
median(x, na.rm = T)
}
})
gamma_ij_0 = dispersions(dq)
species_name = taxa_names(x)
sample_mean = apply(ot.tab, 1, function(y){
if(all(y == 0)){
0
}else{
mean(y[y > 0])
}
})
sample_var = apply(ot.tab, 1, function(y){
if(all(y == 0)){
0
}else{
var(y)
}
})
disp = numeric(0)
for(i in 1:length(sample_var)){
disp[i] = (sample_var[i] - sample_mean[i])/(sample_mean[i])^2
}
alpha_ij_0 = rep(1e-04, length(mu_ij_0))
beta_ij_0 = rep(1, length(mu_ij_0))
ind_not_na_of_mu_ij_0 = which(!is.na(mu_ij_0))#max produce NA for all zeros
ind_less_one_mu_ij_0 = which(abs(mu_ij_0) < 1)
if(stringent){
alpha_ij_0[ind_not_na_of_mu_ij_0] = 1/gamma_ij_0[ind_not_na_of_mu_ij_0]
beta_ij_0[ind_not_na_of_mu_ij_0] = 1/(gamma_ij_0[ind_not_na_of_mu_ij_0] *
mu_ij_0[ind_not_na_of_mu_ij_0])
beta_ij_0[ind_less_one_mu_ij_0] = 1/(gamma_ij_0[ind_less_one_mu_ij_0]*sample_mean[ind_less_one_mu_ij_0])
}else{
alpha_ij_0[ind_not_na_of_mu_ij_0] = 1/gamma_ij_0[ind_not_na_of_mu_ij_0]
beta_ij_0[ind_not_na_of_mu_ij_0] = 1/(gamma_ij_0[ind_not_na_of_mu_ij_0] *
mu_ij_0[ind_not_na_of_mu_ij_0])
}
out = list(mu_ij_0, gamma_ij_0, S_j0, species_name, sample_mean,
sample_var, alpha_ij_0, beta_ij_0)
names(out) = c("mu_ij_0", "gamma_ij_0", "S_j0", "species_name", "sample_mean",
"sample_var", "alpha_ij_0", "beta_ij_0")
return(out)
})
return(compAlphaBeta)
}
alphaBetaNegControl = alphaBetaNegControl(psNCbyBlock = psNCbyBlock)
psByBlock = psBlockResult[[1]]
psNCbyBlock = psBlockResult[[2]]
psallzeroInNC = psBlockResult[[3]]
psPlByBlock = psBlockResult[[4]]
alphaBetaNegControl = alphaBetaNegControl(psNCbyBlock = psNCbyBlock)
num_blks = length(alphaBetaNegControl)
blks = seq(1, num_blks) %>% as.list
gammaPrior_all_blks = lapply(blks, function(x){
gammaPrior = alphaBetaContInPlasma(psPlByBlock = psPlByBlock,
psallzeroInNC = psallzeroInNC,
blk = x,
alphaBetaNegControl=alphaBetaNegControl)
return(gammaPrior)
})
28.17^2*44
devtools::install_github("r-lib/pkgdown")
library(pkgdown)
pkgdown::build_site()
library(pkgdown)
library(pkgdown
)
pkgdown::build_site()
library(BARBI)
pkgdown::build_site()
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
pkgs = c("DESeq2",
"phyloseq",
"dplyr",
"tidyr",
"R.utils",
"BiocParallel",
"doParallel",
"parallel",
"HDInterval",
"grid",
"xtable",
"gtable",
"gridExtra",
"BiocStyle",
"magrittr")
if (!requireNamespace("BiocManager")){
install.packages("BiocManager")
}
BiocManager::install(setdiff(pkgs, installed.packages()))
devtools::install_github("PratheepaJ/BARBI")
library(BARBI)
library(phyloseq)
library(DESeq2)
library(dplyr)
library(tidyr)
library(R.utils)
library(BiocParallel)
library(doParallel)
library(parallel)
library(HDInterval)
library(grid)
library(xtable)
library(gtable)
library(gridExtra)
library(BiocStyle)
library(magrittr)
ps = ps
if(dim(otu_table(ps))[1]!=ntaxa(ps)){otu_table(ps) = t(otu_table(ps))}
blocks = rep("Set1", nsamples(ps))
sample_data(ps)$block = blocks
ps = prune_taxa(taxa_sums(ps)>0, ps)
ps_specimen =  subset_samples(ps, SampleType %in% c("Standard"))
prevTaxaP = apply(otu_table(ps_specimen), 1, function(x){sum(x>0)})
Contaminants1 = names(prevTaxaP)[prevTaxaP == 0]
ps = prune_taxa(prevTaxaP > 0, ps)
ps
totalReads = colSums(otu_table(ps))
hist(log(totalReads), yaxs="i", xaxs="i",
main="Distribution of total reads per sample",
breaks=50)
table(sample_data(ps)$SampleType,sample_data(ps)$block)
psBlockResult = psBlockResults(ps,
sampleTypeVar = "SampleType",
caselevels = c("Standard"),
controllevel = c("Negative"),
sampleName = "sampleID",
blockVar = "block")
library(pkgdown)
pkgdown::build_site()
library(pkgdown)
pkgdown::build_site()
125.91/2
131.65/2
34.4/4
11.89/27
62.96/.44
65.83/.44
8.6/.44
250.91/2
250.91/(2*.44)
699*.15
70*.85
setwd("/Users/pratheepajeganathan/Dropbox/GitHub/STATS191/Grading")
library(readxl)
STATS_191_Fall_2019_grades <- read_excel("STATS_191_Fall_2019_grades.xlsx")
View(STATS_191_Fall_2019_grades)
STATS_191_Fall_2019_grades <- read_excel("STATS_191_Fall_2019_grades.xlsx", header = TRUE)
library(readxl)
STATS_191_Fall_2019_grades <- read_excel("STATS_191_Fall_2019_grades.xlsx",
sheet = "Course Grades")
View(STATS_191_Fall_2019_grades)
head(STATS_191_Fall_2019_grades )
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(magrittr)
df = STATS_191_Fall_2019_grades %>% as.data.frame()
View(df)
rwnames = df[1, ]
rwnames
colnames(rwnames) =NULL
rwnames
length(rwnames)
df = df[-1, ]
View(df)
colnames(df) = rwnames
View(df)
STATS_191_Fall_2019_grades <- read_excel("STATS_191_Fall_2019_grades.xlsx", sheet = "Course Grades")
library(dplyr)
library(magrittr)
df = STATS_191_Fall_2019_grades %>% as.data.frame()
clnames = df[1, ]
colnames(clnames) =NULL
df = df[-1, ]
colnames(df) = clnames
table(df$`Letter grade`)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(BARBI)
library(phyloseq)
library(DESeq2)
library(dplyr)
library(tidyr)
library(R.utils)
library(BiocParallel)
library(doParallel)
library(parallel)
library(HDInterval)
library(grid)
library(xtable)
library(gtable)
library(gridExtra)
library(BiocStyle)
library(magrittr)
ps = ps
