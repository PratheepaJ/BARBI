"0","itera <- 100"
"0","burnIn <- 10"
"0","cov.pro <- .95"
"0","mak_tab <- TRUE"
"0","psByBlock <- readRDS(""./psByBlock.rds"")"
"0","gammaPrior_posTrueSing_all_blocks <- readRDS(""./gammaPrior_posTrueSing_all_blocks.rds"")"
"0","gammaPrior_all_blks <- gammaPrior_posTrueSing_all_blocks[[1]]"
"0","post_all_blocks <- gammaPrior_posTrueSing_all_blocks[[2]]"
"0","all_real_taxa_lt <- list()"
"0","for(blk in 1:num_blks){"
"0","                taxa_post_all_sam <- post_all_blocks[[blk]]"
"0","                gammPrior <- gammaPrior_all_blks[[blk]]"
"0","                total_summary_table <- NULL"
"0","                all_real_taxa <- character()"
"0","                for(sam in 1:nsamples(psPlByBlock[[blk]])){"
"0","                        taxa_post <- taxa_post_all_sam[[sam]]"
"0","                        acceptance <- list()"
"0","                        exp_post_s <- list()"
"0","                        lower.s <- list()"
"0","                        upper.s <- list()"
"0","                        lower.b <- list()"
"0","                        upper.b <- list()"
"0","                        all.zero.nc <- list()"
"0","                        for(taxa in 1:length(taxa_post)){"
"0","                                burnIn  <- burnIn"
"0","                                acceptance[[taxa]]  <-  1-mean(duplicated(taxa_post[[taxa]][-(1:burnIn),]))"
"0","                                exp_post_s[[taxa]] <- mean(taxa_post[[taxa]][-(1:burnIn),])"
"0","                                hdi.v <- hdi(taxa_post[[taxa]][-(1:burnIn),], credMass = cov.pro)"
"0","                                lower.s[[taxa]] <- round(hdi.v[1], digits = 0)"
"0","                                upper.s[[taxa]] <- round(hdi.v[2], digits = 0)"
"0","                                bb <- rgamma((itera-burnIn+1), shape= gammPrior[[sam]][[1]][taxa], rate = gammPrior[[sam]][[2]][taxa])"
"0","                                "
"0","                                exp_bb <- gammPrior[[sam]][[1]][taxa]/gammPrior[[sam]][[2]][taxa]"
"0","                                hdi.b <- hdi(bb, credMass = cov.pro)"
"0","                                lower.b[[taxa]] <- round(hdi.b[1], digits = 0)"
"0","                                upper.b[[taxa]] <- round(hdi.b[2], digits = 0)"
"0","                                all.zero.nc[[taxa]] <-  gammPrior[[sam]][[5]][taxa]"
"0","                                "
"0","                        }"
"0","                        df <- data.frame(Species = taxa_names(psPlByBlock[[blk]]),"
"0","                                         xj = as.numeric(gammPrior[[sam]][[3]]),"
"0","                                         l.s = unlist(lower.s),"
"0","                                         u.s = unlist(upper.s),"
"0","                                         l.b = unlist(lower.b),"
"0","                                         u.b = unlist(upper.b),"
"0","                                         all.zero.nc = unlist(all.zero.nc))"
"0","                        df <- arrange(filter(df,(l.s > u.b) & (l.s > 0)), desc(xj))"
"0","                        if(dim(df)[1]==0){"
"0","                                df <- data.frame(Species=""Negative"","
"0","                                                 xj=""Negative"","
"0","                                                 l.s=""Negative"","
"0","                                                 u.s=""Negative"","
"0","                                                 l.b =""Negative"","
"0","                                                 u.b=""Negative"","
"0","                                                 all.zero.nc = ""Negative"")"
"0","                        }"
"0","                        all_real_taxa <- c(all_real_taxa,"
"0","                                           as.character(df$Species))"
"0","                        if(mak_tab){"
"0","                                filname <- paste(""./"","
"0","                                                 sample_names(psPlByBlock[[blk]])[sam],"
"0","                                                 "".png"","
"0","                                                 sep="""")"
"0","                                png(filname, height = 600, width = 750)"
"0","                                df.p <- tableGrob(df)"
"0","                                title <- textGrob(sample_names(psPlByBlock[[blk]])[sam], gp = gpar(fontsize = 12))"
"0","                                padding <- unit(0.5,""line"")"
"0","                                df.p <- gtable_add_rows("
"0","                                        df.p, heights = grobHeight(title) + padding, pos = 0"
"0","                                )"
"0","                                df.p <- gtable_add_grob("
"0","                                        df.p, list(title),"
"0","                                        t = 1, l = 1, r = ncol(df.p) "
"0","                                )"
"0","                                grid.newpage()"
"0","                                grid.draw(df.p)"
"0","                                dev.off()"
"0","                        }"
"0","                        all_real_taxa <- unique(all_real_taxa)"
"0","                }"
"0","                all_real_taxa_lt[[blk]] <- all_real_taxa"
"0","        }"
